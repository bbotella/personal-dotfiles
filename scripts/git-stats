#!/bin/bash

# Git Quick Stats Script
# Shows useful repository statistics and information

set -e

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

echo -e "${BLUE}📊 Git Repository Statistics${NC}"
echo "============================"
echo

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
    echo -e "${RED}❌ Not in a git repository${NC}"
    exit 1
fi

# Repository information
echo -e "${CYAN}📁 Repository Information:${NC}"
REPO_ROOT=$(git rev-parse --show-toplevel)
echo -e "  Root: ${YELLOW}$REPO_ROOT${NC}"
echo -e "  Remote: ${YELLOW}$(git remote get-url origin 2>/dev/null || echo 'No remote configured')${NC}"
echo

# Current status
echo -e "${CYAN}🌿 Current Status:${NC}"
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
echo -e "  Branch: ${YELLOW}$CURRENT_BRANCH${NC}"
echo -e "  Commit: ${YELLOW}$(git rev-parse --short HEAD)${NC}"
echo -e "  Message: $(git log -1 --pretty=format:'%s')"
echo

# Branch information
echo -e "${CYAN}🌳 Branch Information:${NC}"
TOTAL_BRANCHES=$(git branch -a | wc -l | tr -d ' ')
LOCAL_BRANCHES=$(git branch | wc -l | tr -d ' ')
REMOTE_BRANCHES=$(git branch -r | wc -l | tr -d ' ')
echo -e "  Total branches: ${YELLOW}$TOTAL_BRANCHES${NC}"
echo -e "  Local branches: ${YELLOW}$LOCAL_BRANCHES${NC}"
echo -e "  Remote branches: ${YELLOW}$REMOTE_BRANCHES${NC}"
echo

# Commit statistics
echo -e "${CYAN}📈 Commit Statistics:${NC}"
TOTAL_COMMITS=$(git rev-list --all --count)
COMMITS_THIS_MONTH=$(git rev-list --since="1 month ago" --count HEAD)
COMMITS_THIS_WEEK=$(git rev-list --since="1 week ago" --count HEAD)
echo -e "  Total commits: ${YELLOW}$TOTAL_COMMITS${NC}"
echo -e "  This month: ${YELLOW}$COMMITS_THIS_MONTH${NC}"
echo -e "  This week: ${YELLOW}$COMMITS_THIS_WEEK${NC}"
echo

# Contributors
echo -e "${CYAN}👥 Top Contributors:${NC}"
git shortlog -sn --no-merges | head -5 | sed 's/^/  /'
echo

# File statistics
echo -e "${CYAN}📄 File Statistics:${NC}"
TOTAL_FILES=$(git ls-files | wc -l | tr -d ' ')
echo -e "  Tracked files: ${YELLOW}$TOTAL_FILES${NC}"

# Most changed files
echo -e "  Most changed files:"
git log --pretty=format: --name-only | sort | uniq -c | sort -rg | head -5 | awk '{print "    " $2 " (" $1 " changes)"}' 2>/dev/null || echo "    No file change data available"
echo

# Recent activity
echo -e "${CYAN}🕒 Recent Activity:${NC}"
git log --oneline -10 | sed 's/^/  /'